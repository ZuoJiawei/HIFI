#include "nokia5110.h"
#include "delay.h"
/*??14*14*/
const static unsigned char shuzi[]=
{   
    /*"0",0*/
	0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,
	/*"1",1*/
	0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,
	/*"2",2*/
	0x00,0x70,0x08,0x08,0x08,0xF0,0x00,0x00,0x30,0x2C,0x22,0x21,0x30,0x00,
	/*"3",3*/
	0x00,0x30,0x08,0x88,0x88,0x70,0x00,0x00,0x18,0x20,0x20,0x31,0x1E,0x00,
	/*"4",4*/
	0x00,0x80,0x40,0x20,0xF8,0x00,0x00,0x06,0x05,0x04,0x24,0x3F,0x24,0x04,
	/*"5",5*/
	0x00,0xF8,0x08,0x88,0x88,0x08,0x00,0x00,0x19,0x21,0x20,0x31,0x1F,0x00,
	/*"6",6*/
	0xE0,0x10,0x88,0x88,0x88,0x18,0x00,0x0F,0x11,0x20,0x20,0x31,0x1F,0x00,
	/*"7",7*/
	0x00,0x38,0x08,0x08,0xE8,0x18,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,
	/*"8",8*/
	0x70,0x98,0x88,0x08,0x98,0x70,0x00,0x1E,0x21,0x21,0x21,0x31,0x1E,0x00,
	/*"9",9*/
	0xF0,0x08,0x08,0x08,0x18,0xE0,0x00,0x31,0x22,0x22,0x32,0x19,0x07,0x00      
}; 
/*??16*16*/
const static unsigned char hanzi[]=
{
  /*"?",0*/
  0x00,0x00,0xFE,0x02,0x02,0xF2,0x92,0x9A,0x96,0x92,0x92,0xF2,0x02,0x02,0x02,0x00,
  0x80,0x60,0x1F,0x40,0x20,0x17,0x44,0x84,0x7C,0x04,0x04,0x17,0x20,0x40,0x00,0x00,

  /*"?",1*/
  0x80,0x82,0x82,0x82,0x82,0x82,0x82,0xE2,0xA2,0x92,0x8A,0x86,0x82,0x80,0x80,0x00,
  0x00,0x00,0x00,0x00,0x00,0x40,0x80,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  /*"?",2*/
  0x80,0x82,0x82,0x82,0xFE,0x82,0x82,0x82,0x82,0x82,0xFE,0x82,0x82,0x82,0x80,0x00,
  0x00,0x80,0x40,0x30,0x0F,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,
  /*"?",3*/
  0x00,0x00,0x18,0x16,0x10,0xD0,0xB8,0x97,0x90,0x90,0x90,0x92,0x94,0x10,0x00,0x00,
  0x00,0x20,0x10,0x8C,0x83,0x80,0x41,0x46,0x28,0x10,0x28,0x44,0x43,0x80,0x80,0x00,
  /*"?",4*/
  0x10,0x10,0xD0,0xFF,0x90,0x10,0x00,0xFC,0x24,0xE4,0x24,0x22,0x23,0xE2,0x00,0x00,
  0x04,0x03,0x00,0xFF,0x00,0x83,0x60,0x1F,0x80,0x41,0x26,0x18,0x26,0x41,0x80,0x00
};  


void Nokia5110_GPIO_Init(void)
{
	GPIO_InitTypeDef GPIO_InitStruct;
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOE,ENABLE);

	GPIO_InitStruct.GPIO_Pin=GPIO_Pin_15|GPIO_Pin_13|GPIO_Pin_12|GPIO_Pin_11|GPIO_Pin_14;
	GPIO_InitStruct.GPIO_Speed=GPIO_Speed_50MHz;
	GPIO_InitStruct.GPIO_OType=GPIO_OType_PP;
	GPIO_Init(GPIOE,&GPIO_InitStruct);
	GPIO_SetBits(GPIOE,GPIO_Pin_11); 	
	
// 	GPIO_InitStruct.GPIO_Pin=GPIO_Pin_6;
// 	GPIO_Init(GPIOB,&GPIO_InitStruct);
	GPIO_SetBits(GPIOE,GPIO_Pin_15);
	
// 	GPIO_InitStruct.GPIO_Pin=GPIO_Pin_7;
// 	GPIO_Init(GPIOB,&GPIO_InitStruct);
	GPIO_SetBits(GPIOE,GPIO_Pin_14);
	
// 	GPIO_InitStruct.GPIO_Pin=GPIO_Pin_8;
// 	GPIO_Init(GPIOB,&GPIO_InitStruct);
	GPIO_SetBits(GPIOE,GPIO_Pin_13);
	
// 	GPIO_InitStruct.GPIO_Pin=GPIO_Pin_9;
// 	GPIO_Init(GPIOB,&GPIO_InitStruct);
	GPIO_SetBits(GPIOE,GPIO_Pin_12);
/*RCC->APB2ENR|=1<<2;
 GPIOA->CRL&=0xFFFF0000; //????

 GPIOA->CRL|=0x00003333;  //?????????
 GPIOA->ODR|=0xf; 
// GPIOA->ODR|=1<<1;
// GPIOA->ODR|=1<<2;
// GPIOA->ODR|=1<<3;

 GPIOA->CRH&=0xfffffff0;
 GPIOA->CRH|=0x00000003;
 GPIOA->ODR|=1<<0;*/
}
void Nokia5110_WriteByte(u8 dt,u8 command )
{
   u8 i;
   sce=0;
   dc=command;
   for(i=0;i<8;i++)
   {
   		if(dt&0x80)
		   sdin=1;
		else
		   sdin=0;
		dt<<=1;
		sclk=0;
		sclk=1;
   }
   dc=1;
   sce=1;
   sdin=1;
}

void Nokia5110_Init(void)
{
	Res=0;
	delay_ms(10);
	Res=1;
	Nokia5110_WriteByte(0x21,0);//???Lcd,??????????
	Nokia5110_WriteByte(0xd0,0);//???????? 
	Nokia5110_WriteByte(0x20,0);//??????
	Nokia5110_WriteByte(0x0c,0);//??????,????
}


void Nokia5110_Set_XY(u8 X,u8 Y)
{
	Nokia5110_WriteByte(0x40|Y,0);//column	
	Nokia5110_WriteByte(0x80|X,0);//row
}

void Nokia5110_Clear(void)
{
	u8 t,k;
	Nokia5110_Set_XY(0,0);
	for(t=0;t<6;t++)
	{
		for(k=0;k<84;k++)
		{
			Nokia5110_WriteByte(0x00,1);
		}
	}
}
   
void Nokia5110_Write_Shu(u8 row,u8 page,u8 c)
{
   u8 i;
   Nokia5110_Set_XY(row*7,page);
   for(i=0;i<7;i++)
   {
   		Nokia5110_WriteByte(shuzi[c*14+i],1);		
   }
   Nokia5110_Set_XY(row*7,page+1);
   for(i=7;i<14;i++)
   {
   		Nokia5110_WriteByte(shuzi[c*14+i],1);		
   }
}	

void Nokia5110_Write_Hanzi(u8 row,u8 page,u8 c)
{
   u8 i;
   Nokia5110_Set_XY(row*8,page);
   for(i=0;i<16;i++)
   {
   		Nokia5110_WriteByte(hanzi[c*32+i],1);		
   }
   Nokia5110_Set_XY(row*8,page+1);
   for(i=16;i<32;i++)
   {
   		Nokia5110_WriteByte(hanzi[c*32+i],1);		
   }
}

void Nokia5110_int(void)
{
	Nokia5110_GPIO_Init();
	Res=0;
	delay_ms(10);
	Res=1;
	Nokia5110_Init();
	Nokia5110_Clear();
//	while(1)
//	{ 
//		Nokia5110_Write_Hanzi(0,0,0);
//		Nokia5110_Write_Hanzi(2,0,1);
//		Nokia5110_Write_Hanzi(4,0,2);
//		Nokia5110_Write_Hanzi(6,0,3);
//		Nokia5110_Write_Hanzi(8,0,4);
//		Nokia5110_Write_Shu(4,2,8);
//		Nokia5110_Write_Shu(5,2,8);
//		Nokia5110_Write_Shu(6,2,7);
//		Nokia5110_Write_Shu(4,4,5);
//		Nokia5110_Write_Shu(5,4,2);
//		Nokia5110_Write_Shu(6,4,1);
//	}
}
